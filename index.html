<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra Wash Terms & Conditions</title>
<style>
:root {
  --font-family: 'Open Sans', sans-serif;
  --font-size-label: 14px;
  --font-size-input: 14px;
  --font-size-header: 22px;
  --color-background: #f6f7fa;
  --color-card-bg: #ffffff;
  --color-card-border: #dbdfe7;
  --color-card-shadow: rgba(99, 77, 255, 0.06);
  --color-header: #333;
  --color-label: #555;
  --color-input-border: #ccc;
  --color-input-text: #333;
  --color-focus-border: #5a4cc2;
  --color-btn-bg: #ff6d5a;
  --color-btn-text: #fff;
  --radius: 6px;
  --container-width: 440px;
}
body {
  font-family: var(--font-family);
  background-color: var(--color-background);
  display: flex;
  justify-content: center;
  padding: 32px;
}
form {
  background: var(--color-card-bg);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius);
  box-shadow: 0 4px 12px var(--color-card-shadow);
  padding: 24px;
  width: var(--container-width);
}
h1 {
  text-align: center;
  font-size: var(--font-size-header);
  color: var(--color-header);
  margin-bottom: 24px;
}
label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: var(--font-size-label);
}
input[type="text"],
input[type="tel"],
textarea,
select {
  width: 100%;
  padding: 10px;
  font-size: var(--font-size-input);
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  margin-bottom: 16px;
  box-sizing: border-box;
}
input:focus,
textarea:focus,
select:focus {
  outline: none;
  border-color: var(--color-focus-border);
  box-shadow: 0 0 4px var(--color-focus-border);
}
button[type="submit"] {
  background-color: var(--color-btn-bg);
  color: var(--color-btn-text);
  border: none;
  padding: 12px;
  width: 100%;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: var(--font-size-input);
  cursor: pointer;
  margin-bottom: 16px;
}
button[type="submit"]:hover { background-color: #e05343; }
.note { font-size: 13px; color: #555; margin: 4px 0 16px 0; line-height: 1.4; }
.small-checkbox-label { 
  font-size: 13px; 
  margin-left: 4px;
  vertical-align: middle;
}
.auto-filled {
  background-color: #f0f7ff;
  border-left: 4px solid #4a90e2;
}

/* Custom dropdown styles */
.custom-dropdown {
  position: relative;
  margin-bottom: 16px;
}

.dropdown-select {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px;
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  cursor: pointer;
  background-color: white;
}

.dropdown-select:after {
  content: "â–¼";
  font-size: 12px;
  transition: transform 0.2s;
}

.dropdown-select.open:after {
  transform: rotate(180deg);
}

.dropdown-search {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  margin-bottom: 8px;
  box-sizing: border-box;
  display: none;
}

.dropdown-options {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  background: white;
  z-index: 100;
  display: none;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.dropdown-options.open {
  display: block;
}

.dropdown-option {
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid #f0f0f0;
}

.dropdown-option:last-child {
  border-bottom: none;
}

.dropdown-option:hover {
  background-color: #f6f7fa;
}

.dropdown-option.selected {
  background-color: #e6f7ff;
  font-weight: 600;
}

.scroll-box {
  background:#f9f9f9;
  border:1px solid #ddd;
  padding:12px;
  border-radius:6px;
  max-height:300px;
  overflow:auto;
  font-size:13px;
  line-height:1.5;
  margin-bottom:16px;
}

.checkbox-container {
  margin-bottom: 16px;
  display: flex;
  align-items: center;
}

.checkbox-container input[type="checkbox"] {
  margin-right: 8px;
  vertical-align: middle;
}

.checkbox-label {
  font-size: 13px;
  vertical-align: middle;
}
</style>
</head>
<body>

<form id="termsForm">
  <h1>Ultra Wash Terms & Conditions</h1>
  
  <!-- Customer Reference Field -->
  <label for="customerRef">Customer Reference</label>
  <div class="custom-dropdown" id="customerRefDropdown">
    <div class="dropdown-select" id="customerRefSelect">
      <span>Select Customer</span>
    </div>
    <input type="text" class="dropdown-search" id="customerRefSearch" placeholder="Search customers...">
    <div class="dropdown-options" id="customerRefOptions"></div>
    <input type="hidden" id="customerRef" name="customerRef" required>
  </div>

  <!-- Auto-filled customer info -->
  <div id="customerInfo" style="display: none;">
    <label for="customerName">Customer Name</label>
    <input id="customerName" name="customerName" type="text" readonly class="auto-filled" />
    
    <label for="customerPhone">Phone Number</label>
    <input id="customerPhone" name="customerPhone" type="text" readonly class="auto-filled" />
  </div>

  <div class="scroll-box">
    1. <strong>Inspection Before Washing</strong><br>
    Our team will inspect your items for stains, tears, or anything needing special attention. We'll inform you before washing and will only proceed once we have received your confirmation.<br><br>

    2. <strong>Pre-Existing Damage Disclaimer</strong><br>
    We are not responsible for:
    <ul style="margin:4px 0 8px 20px;padding:0;">
      <li>Damage that existed before washing (holes, tears, worn fabric)</li>
      <li>Shrinkage, fading, or color bleeding caused by poor fabric quality</li>
      <li>Items without care labels or if special instructions weren't provided</li>
    </ul>

    3. <strong>Cleaning Process Limitations</strong><br>
    Despite careful handling, some wear and tear may occur. We are not liable for:
    <ul style="margin:4px 0 8px 20px;padding:0;">
      <li>Shrinkage or color changes</li>
      <li>Fabric weakness or natural deterioration</li>
      <li>Items left inside pockets or hidden areas</li>
    </ul>

    4. <strong>Disposal Policy</strong><br>
    We will only dispose of items if you clearly ask us to. Otherwise, all items will be returned to you.<br><br>

    5. <strong>Liability & Compensation</strong><br>
    <ul style="margin:4px 0 0 20px;padding:0;">
      <li>If an item is lost or incurs any damages during normal cleaning, our maximum compensation is limited to its cleaning value, based on the weight and your subscription.</li>
      <li>We will not offer full value replacements, refunds, or any other extra compensation to cover the original total cost of the damaged items.</li>
      <li>All subscription payments are final and non-refundable, even if unused or partially used.</li>
    </ul>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="agreeCheckbox">
    <label for="agreeCheckbox" class="checkbox-label">I Agree</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="disagreeCheckbox">
    <label for="disagreeCheckbox" class="checkbox-label">I Disagree</label>
  </div>

  <button type="submit">Submit</button>
</form>

<script>
const agree = document.getElementById('agreeCheckbox');
const disagree = document.getElementById('disagreeCheckbox');

// Only allow one checkbox to be selected
agree.addEventListener('change', () => { if(agree.checked) disagree.checked = false; });
disagree.addEventListener('change', () => { if(disagree.checked) agree.checked = false; });

// Form submission
document.getElementById('termsForm').addEventListener('submit', function(e){
  e.preventDefault();
  
  // Validate customer selection
  if (!document.getElementById('customerRef').value) {
    alert('Please select a customer');
    return;
  }
  
  // Validate agreement selection
  if (!agree.checked && !disagree.checked) {
    alert('Please select either "I Agree" or "I Disagree"');
    return;
  }
  
  // Prepare form data for submission
  const formData = new FormData(this);
  
  // Show loading state
  const submitBtn = this.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'Submitting...';
  submitBtn.disabled = true;
  
  // In a real implementation, you would send this data to your backend
  setTimeout(() => {
    alert("Form submitted successfully.");
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }, 1000);
});

// NEW: Custom dropdown functionality
const customerRefDropdown = document.getElementById('customerRefDropdown');
const customerRefSelect = document.getElementById('customerRefSelect');
const customerRefSearch = document.getElementById('customerRefSearch');
const customerRefOptions = document.getElementById('customerRefOptions');
const customerRefHidden = document.getElementById('customerRef');
const customerInfo = document.getElementById('customerInfo');
const customerName = document.getElementById('customerName');
const customerPhone = document.getElementById('customerPhone');

// Global variable to store customers
let allCustomers = [];

// Setup custom dropdown functionality
function setupCustomDropdown() {
  // Toggle dropdown visibility
  customerRefSelect.addEventListener('click', function(e) {
    e.stopPropagation();
    customerRefDropdown.classList.toggle('open');
    customerRefSearch.style.display = customerRefDropdown.classList.contains('open') ? 'block' : 'none';
    customerRefOptions.classList.toggle('open');
    
    if (customerRefDropdown.classList.contains('open')) {
      customerRefSearch.focus();
    }
  });
  
  // Filter options when typing in search
  customerRefSearch.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const options = customerRefOptions.querySelectorAll('.dropdown-option');
    
    options.forEach(option => {
      const text = option.textContent.toLowerCase();
      option.style.display = text.includes(searchTerm) ? 'block' : 'none';
    });
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!customerRefDropdown.contains(e.target)) {
      customerRefDropdown.classList.remove('open');
      customerRefSearch.style.display = 'none';
      customerRefOptions.classList.remove('open');
    }
  });
  
  // Prevent closing when clicking inside dropdown
  customerRefDropdown.addEventListener('click', function(e) {
    e.stopPropagation();
  });
}

// Populate custom dropdown with customers
function populateCustomDropdown(customers) {
  customerRefOptions.innerHTML = '';
  
  customers.forEach(cust => {
    const option = document.createElement('div');
    option.className = 'dropdown-option';
    option.textContent = `${cust["Name"]} (${cust["Customer ID"] || cust["Phone"]})`;
    option.dataset.value = cust["Customer ID"] || cust["Phone"];
    option.dataset.name = cust["Name"];
    option.dataset.phone = cust["Phone"];
    
    option.addEventListener('click', function() {
      // Update selected value
      customerRefHidden.value = this.dataset.value;
      customerRefSelect.querySelector('span').textContent = this.textContent;
      
      // Close dropdown
      customerRefDropdown.classList.remove('open');
      customerRefSearch.style.display = 'none';
      customerRefOptions.classList.remove('open');
      
      // Remove previous selections
      customerRefOptions.querySelectorAll('.dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Highlight selected option
      this.classList.add('selected');
      
      // Auto-fill customer info
      customerName.value = this.dataset.name || "";
      customerPhone.value = this.dataset.phone || "";
      customerInfo.style.display = 'block';
    });
    
    customerRefOptions.appendChild(option);
  });
}

// Load customer list from Google Apps Script (same as in new form)
async function loadCustomers() {
  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbwRk-T3xGVFx0PzQSXqJ9piRLk8tXUWzcyDDHOfCxDuhLJ1V2PAPt87LETLZ1ZkbpnZmA/exec");
    allCustomers = await response.json();
    
    // Set up custom dropdown
    setupCustomDropdown();
    populateCustomDropdown(allCustomers);

  } catch (err) {
    console.error("Error loading customers:", err);
    // Fallback to sample data if live data fails
    const sampleCustomers = [
      { "Name": "John Smith", "Phone": "+673 8221133", "Customer ID": "CUST001" },
      { "Name": "Sarah Johnson", "Phone": "+673 8221144", "Customer ID": "CUST002" },
      { "Name": "Michael Brown", "Phone": "+673 8221155", "Customer ID": "CUST003" },
      { "Name": "Emily Davis", "Phone": "+673 8221166", "Customer ID": "CUST004" },
      { "Name": "David Wilson", "Phone": "+673 8221177", "Customer ID": "CUST005" }
    ];
    setupCustomDropdown();
    populateCustomDropdown(sampleCustomers);
  }
}

// Initialize the dropdown when page loads
window.addEventListener('DOMContentLoaded', loadCustomers);
</script>

</body>
</html>
